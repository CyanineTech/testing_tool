<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testing Tool Web ç®¡ç†ç•Œé¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 500;
        }
        
        .tab:hover {
            background: #e0e0e0;
        }
        
        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .scripts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .script-card {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s;
            background: #fafafa;
        }
        
        .script-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        
        .script-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.3em;
        }
        
        .script-card .description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
            min-height: 60px;
        }
        
        .script-card .workflow {
            background: #fff;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            min-height: 80px;
            font-family: monospace;
            font-size: 0.9em;
        }
        
        .btn {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .config-section {
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            background: #fafafa;
        }
        
        .config-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        
        .config-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .config-item label {
            flex: 0 0 200px;
            font-weight: 500;
            color: #333;
        }
        
        .config-item input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .terminal {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 500px;
            overflow-y: auto;
            margin: 20px 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .logs-container {
            display: flex;
            gap: 20px;
        }
        
        .logs-list {
            flex: 0 0 300px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            background: #fafafa;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .log-item {
            padding: 10px;
            margin-bottom: 10px;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .log-item:hover {
            border-color: #667eea;
        }
        
        .log-item.active {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .log-content {
            flex: 1;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            background: #fafafa;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }
        
        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 10px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .modal-header h2 {
            color: #667eea;
        }
        
        .close {
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }
        
        .close:hover {
            color: #000;
        }
        
        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .alert-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .process-info {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .process-info h4 {
            margin-bottom: 10px;
            color: #856404;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ Testing Tool ç®¡ç†å¹³å°</h1>
            <p>Webç•Œé¢ç®¡ç†å’Œæ‰§è¡ŒPythonè„šæœ¬å·¥å…·é›†</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('scripts')">ğŸ“œ è„šæœ¬ç®¡ç†</button>
            <button class="tab" onclick="showTab('config')">âš™ï¸ é…ç½®ç®¡ç†</button>
            <button class="tab" onclick="showTab('execute')">â–¶ï¸ æ‰§è¡Œè„šæœ¬</button>
            <button class="tab" onclick="showTab('logs')">ğŸ“‹ æ—¥å¿—æŸ¥çœ‹</button>
        </div>
        
        <!-- è„šæœ¬ç®¡ç†æ ‡ç­¾é¡µ -->
        <div id="scripts-tab" class="tab-content active">
            <h2>è„šæœ¬åˆ—è¡¨</h2>
            <div id="scripts-container" class="scripts-grid"></div>
        </div>
        
        <!-- é…ç½®ç®¡ç†æ ‡ç­¾é¡µ -->
        <div id="config-tab" class="tab-content">
            <h2>é…ç½®æ–‡ä»¶ç®¡ç† (config.ini)</h2>
            <div id="config-container"></div>
            <button class="btn btn-success" onclick="saveConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
        </div>
        
        <!-- æ‰§è¡Œè„šæœ¬æ ‡ç­¾é¡µ -->
        <div id="execute-tab" class="tab-content">
            <h2>æ‰§è¡Œè„šæœ¬</h2>
            <div class="form-group">
                <label>é€‰æ‹©è„šæœ¬:</label>
                <select id="execute-script-select" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 16px;">
                    <option value="">-- è¯·é€‰æ‹©è„šæœ¬ --</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>å‘½ä»¤è¡Œå‚æ•° (å¯é€‰):</label>
                <input type="text" id="execute-args" placeholder="ä¾‹å¦‚: --debug --scene_id 18" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
            </div>
            
            <div class="form-group">
                <label>å·¥ä½œæµç¨‹è¯´æ˜:</label>
                <div id="execute-workflow" style="background: #f5f5f5; padding: 15px; border-radius: 5px; min-height: 80px; border: 2px solid #ddd;"></div>
            </div>
            
            <button class="btn btn-success" onclick="executeScript()">â–¶ï¸ æ‰§è¡Œè„šæœ¬</button>
            <button class="btn btn-danger" onclick="stopScript()" id="stop-btn" style="display: none;">â¹ï¸ åœæ­¢æ‰§è¡Œ</button>
            
            <div id="process-info" style="display: none;"></div>
            <div id="terminal-output" class="terminal" style="display: none;"></div>
        </div>
        
        <!-- æ—¥å¿—æŸ¥çœ‹æ ‡ç­¾é¡µ -->
        <div id="logs-tab" class="tab-content">
            <h2>æ—¥å¿—æ–‡ä»¶</h2>
            <div class="logs-container">
                <div class="logs-list" id="logs-list"></div>
                <div class="log-content">
                    <h3>æ—¥å¿—å†…å®¹</h3>
                    <button class="btn btn-primary" onclick="refreshLogContent()">ğŸ”„ åˆ·æ–°</button>
                    <div id="log-content-display" class="terminal"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ç¼–è¾‘è„šæœ¬æ¨¡æ€æ¡† -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ç¼–è¾‘è„šæœ¬ä¿¡æ¯</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div id="edit-alert"></div>
            <form id="edit-form">
                <input type="hidden" id="edit-script-name">
                <div class="form-group">
                    <label>è„šæœ¬åç§°:</label>
                    <input type="text" id="edit-script-display-name" readonly style="width: 100%; padding: 10px; background: #f5f5f5; border: 2px solid #ddd; border-radius: 5px;">
                </div>
                <div class="form-group">
                    <label>è„šæœ¬æè¿°:</label>
                    <textarea id="edit-description" rows="6"></textarea>
                </div>
                <div class="form-group">
                    <label>å·¥ä½œæµç¨‹:</label>
                    <textarea id="edit-workflow" rows="8" placeholder="æè¿°è„šæœ¬çš„æ‰§è¡Œæµç¨‹ã€å‰ç½®æ¡ä»¶ã€å‚æ•°è¯´æ˜ç­‰"></textarea>
                </div>
                <button type="button" class="btn btn-success" onclick="saveScriptInfo()">ğŸ’¾ ä¿å­˜</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
            </form>
        </div>
    </div>
    
    <script>
        let scripts = {};
        let config = {};
        let currentLogFile = null;
        let currentProcessId = null;
        let eventSource = null;
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadScripts();
            loadConfig();
            loadLogs();
        });
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function showTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µ
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
            
            // å¦‚æœåˆ‡æ¢åˆ°æ—¥å¿—é¡µï¼Œåˆ·æ–°æ—¥å¿—åˆ—è¡¨
            if (tabName === 'logs') {
                loadLogs();
            }
        }
        
        // åŠ è½½è„šæœ¬åˆ—è¡¨
        async function loadScripts() {
            try {
                const response = await fetch('/api/scripts');
                scripts = await response.json();
                displayScripts();
                updateExecuteScriptSelect();
            } catch (error) {
                console.error('åŠ è½½è„šæœ¬å¤±è´¥:', error);
            }
        }
        
        // æ˜¾ç¤ºè„šæœ¬åˆ—è¡¨
        function displayScripts() {
            const container = document.getElementById('scripts-container');
            container.innerHTML = '';
            
            for (const [name, script] of Object.entries(scripts)) {
                const card = document.createElement('div');
                card.className = 'script-card';
                card.innerHTML = `
                    <h3>ğŸ“„ ${script.name}</h3>
                    <div class="description">${script.description || 'æš‚æ— æè¿°'}</div>
                    <div class="workflow">${script.workflow || 'æš‚æ— å·¥ä½œæµç¨‹è¯´æ˜'}</div>
                    <button class="btn btn-primary" onclick="editScript('${name}')">âœï¸ ç¼–è¾‘</button>
                    <button class="btn btn-secondary" onclick="downloadScript('${name}')">â¬‡ï¸ ä¸‹è½½</button>
                `;
                container.appendChild(card);
            }
        }
        
        // æ›´æ–°æ‰§è¡Œè„šæœ¬ä¸‹æ‹‰æ¡†
        function updateExecuteScriptSelect() {
            const select = document.getElementById('execute-script-select');
            select.innerHTML = '<option value="">-- è¯·é€‰æ‹©è„šæœ¬ --</option>';
            
            for (const [name, script] of Object.entries(scripts)) {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = script.name;
                select.appendChild(option);
            }
            
            select.addEventListener('change', function() {
                const scriptName = this.value;
                if (scriptName && scripts[scriptName]) {
                    document.getElementById('execute-workflow').textContent = 
                        scripts[scriptName].workflow || 'æš‚æ— å·¥ä½œæµç¨‹è¯´æ˜';
                } else {
                    document.getElementById('execute-workflow').textContent = '';
                }
            });
        }
        
        // ç¼–è¾‘è„šæœ¬
        function editScript(scriptName) {
            const script = scripts[scriptName];
            document.getElementById('edit-script-name').value = scriptName;
            document.getElementById('edit-script-display-name').value = script.name;
            document.getElementById('edit-description').value = script.description || '';
            document.getElementById('edit-workflow').value = script.workflow || '';
            document.getElementById('edit-alert').innerHTML = '';
            document.getElementById('edit-modal').style.display = 'block';
        }
        
        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('edit-modal').style.display = 'none';
        }
        
        // ä¿å­˜è„šæœ¬ä¿¡æ¯
        async function saveScriptInfo() {
            const scriptName = document.getElementById('edit-script-name').value;
            const description = document.getElementById('edit-description').value;
            const workflow = document.getElementById('edit-workflow').value;
            
            try {
                const response = await fetch(`/api/scripts/${scriptName}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({description, workflow})
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    document.getElementById('edit-alert').innerHTML = 
                        '<div class="alert alert-success">âœ… ' + result.message + '</div>';
                    setTimeout(() => {
                        closeModal();
                        loadScripts();
                    }, 1500);
                } else {
                    document.getElementById('edit-alert').innerHTML = 
                        '<div class="alert alert-error">âŒ ' + result.message + '</div>';
                }
            } catch (error) {
                document.getElementById('edit-alert').innerHTML = 
                    '<div class="alert alert-error">âŒ ä¿å­˜å¤±è´¥: ' + error.message + '</div>';
            }
        }
        
        // ä¸‹è½½è„šæœ¬
        function downloadScript(scriptName) {
            window.location.href = `/api/download/${scriptName}`;
        }
        
        // åŠ è½½é…ç½®
        async function loadConfig() {
            try {
                const response = await fetch('/api/config');
                config = await response.json();
                displayConfig();
            } catch (error) {
                console.error('åŠ è½½é…ç½®å¤±è´¥:', error);
            }
        }
        
        // æ˜¾ç¤ºé…ç½®
        function displayConfig() {
            const container = document.getElementById('config-container');
            container.innerHTML = '';
            
            for (const [section, options] of Object.entries(config)) {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'config-section';
                
                let html = `<h3>[${section}]</h3>`;
                for (const [key, value] of Object.entries(options)) {
                    html += `
                        <div class="config-item">
                            <label>${key}:</label>
                            <input type="text" 
                                   data-section="${section}" 
                                   data-key="${key}" 
                                   value="${value || ''}"
                                   class="config-input">
                        </div>
                    `;
                }
                sectionDiv.innerHTML = html;
                container.appendChild(sectionDiv);
            }
        }
        
        // ä¿å­˜é…ç½®
        async function saveConfig() {
            const newConfig = {};
            
            document.querySelectorAll('.config-input').forEach(input => {
                const section = input.dataset.section;
                const key = input.dataset.key;
                const value = input.value;
                
                if (!newConfig[section]) {
                    newConfig[section] = {};
                }
                newConfig[section][key] = value;
            });
            
            try {
                const response = await fetch('/api/config', {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(newConfig)
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    alert('âœ… ' + result.message);
                    loadConfig();
                } else {
                    alert('âŒ ' + result.message);
                }
            } catch (error) {
                alert('âŒ ä¿å­˜å¤±è´¥: ' + error.message);
            }
        }
        
        // æ‰§è¡Œè„šæœ¬
        async function executeScript() {
            const scriptName = document.getElementById('execute-script-select').value;
            if (!scriptName) {
                alert('è¯·é€‰æ‹©è¦æ‰§è¡Œçš„è„šæœ¬');
                return;
            }
            
            const argsStr = document.getElementById('execute-args').value.trim();
            const args = argsStr ? argsStr.split(/\s+/) : [];
            
            // æ¸…ç©ºç»ˆç«¯è¾“å‡º
            const terminal = document.getElementById('terminal-output');
            terminal.innerHTML = 'æ­£åœ¨å¯åŠ¨è„šæœ¬...\n';
            terminal.style.display = 'block';
            
            try {
                const response = await fetch(`/api/execute/${scriptName}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({args})
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    currentProcessId = result.process_id;
                    document.getElementById('stop-btn').style.display = 'inline-block';
                    
                    // æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯
                    const processInfo = document.getElementById('process-info');
                    processInfo.innerHTML = `
                        <div class="process-info">
                            <h4>âš™ï¸ è¿›ç¨‹è¿è¡Œä¸­</h4>
                            <p>è„šæœ¬: ${scriptName}</p>
                            <p>è¿›ç¨‹ID: ${currentProcessId}</p>
                            <p>å¯åŠ¨æ—¶é—´: ${new Date().toLocaleString()}</p>
                        </div>
                    `;
                    processInfo.style.display = 'block';
                    
                    // å¼€å§‹æ¥æ”¶è¾“å‡º
                    connectToProcessOutput(currentProcessId);
                } else {
                    terminal.innerHTML += 'âŒ å¯åŠ¨å¤±è´¥: ' + result.message + '\n';
                }
            } catch (error) {
                terminal.innerHTML += 'âŒ æ‰§è¡Œå¤±è´¥: ' + error.message + '\n';
            }
        }
        
        // è¿æ¥åˆ°è¿›ç¨‹è¾“å‡ºæµ
        function connectToProcessOutput(processId) {
            if (eventSource) {
                eventSource.close();
            }
            
            eventSource = new EventSource(`/api/process/${processId}/output`);
            const terminal = document.getElementById('terminal-output');
            
            eventSource.onmessage = function(event) {
                const data = JSON.parse(event.data);
                
                if (data.type === 'output') {
                    terminal.innerHTML += data.data;
                    terminal.scrollTop = terminal.scrollHeight;
                } else if (data.type === 'end') {
                    terminal.innerHTML += '\nâœ… è¿›ç¨‹å·²ç»“æŸ\n';
                    eventSource.close();
                    document.getElementById('stop-btn').style.display = 'none';
                    currentProcessId = null;
                } else if (data.type === 'error') {
                    terminal.innerHTML += '\nâŒ é”™è¯¯: ' + data.message + '\n';
                    eventSource.close();
                    document.getElementById('stop-btn').style.display = 'none';
                    currentProcessId = null;
                }
            };
            
            eventSource.onerror = function() {
                terminal.innerHTML += '\nâš ï¸ è¿æ¥ä¸­æ–­\n';
                eventSource.close();
                document.getElementById('stop-btn').style.display = 'none';
            };
        }
        
        // åœæ­¢è„šæœ¬
        async function stopScript() {
            if (!currentProcessId) {
                return;
            }
            
            if (!confirm('ç¡®å®šè¦åœæ­¢å½“å‰è„šæœ¬æ‰§è¡Œå—ï¼Ÿ')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/process/${currentProcessId}/stop`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                const terminal = document.getElementById('terminal-output');
                
                if (result.status === 'success') {
                    terminal.innerHTML += '\nâ¹ï¸ å·²åœæ­¢æ‰§è¡Œ\n';
                } else {
                    terminal.innerHTML += '\nâŒ åœæ­¢å¤±è´¥: ' + result.message + '\n';
                }
                
                if (eventSource) {
                    eventSource.close();
                }
                document.getElementById('stop-btn').style.display = 'none';
                currentProcessId = null;
            } catch (error) {
                const terminal = document.getElementById('terminal-output');
                terminal.innerHTML += '\nâŒ åœæ­¢å¤±è´¥: ' + error.message + '\n';
            }
        }
        
        // åŠ è½½æ—¥å¿—åˆ—è¡¨
        async function loadLogs() {
            try {
                const response = await fetch('/api/logs');
                const logs = await response.json();
                displayLogs(logs);
            } catch (error) {
                console.error('åŠ è½½æ—¥å¿—å¤±è´¥:', error);
            }
        }
        
        // æ˜¾ç¤ºæ—¥å¿—åˆ—è¡¨
        function displayLogs(logs) {
            const container = document.getElementById('logs-list');
            container.innerHTML = '<h3>æ—¥å¿—æ–‡ä»¶åˆ—è¡¨</h3>';
            
            if (logs.length === 0) {
                container.innerHTML += '<p>æš‚æ— æ—¥å¿—æ–‡ä»¶</p>';
                return;
            }
            
            logs.forEach(log => {
                const logItem = document.createElement('div');
                logItem.className = 'log-item';
                logItem.innerHTML = `
                    <strong>${log.name}</strong><br>
                    <small>å¤§å°: ${(log.size / 1024).toFixed(2)} KB</small><br>
                    <small>ä¿®æ”¹: ${new Date(log.modified).toLocaleString()}</small>
                `;
                logItem.onclick = (e) => loadLogContent(log.name, e);
                container.appendChild(logItem);
            });
        }
        
        // åŠ è½½æ—¥å¿—å†…å®¹
        async function loadLogContent(logName, clickEvent) {
            currentLogFile = logName;
            
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            if (clickEvent) {
                document.querySelectorAll('.log-item').forEach(item => {
                    item.classList.remove('active');
                });
                clickEvent.target.closest('.log-item').classList.add('active');
            }
            
            try {
                const response = await fetch(`/api/logs/${logName}`);
                const result = await response.json();
                
                const display = document.getElementById('log-content-display');
                display.innerHTML = result.content || 'æ—¥å¿—ä¸ºç©º';
                
                if (result.total_lines > result.shown_lines) {
                    display.innerHTML = `æ˜¾ç¤ºæœ€å ${result.shown_lines} / ${result.total_lines} è¡Œ\n\n` + display.innerHTML;
                }
            } catch (error) {
                document.getElementById('log-content-display').innerHTML = 
                    'âŒ åŠ è½½å¤±è´¥: ' + error.message;
            }
        }
        
        // åˆ·æ–°æ—¥å¿—å†…å®¹
        function refreshLogContent() {
            if (currentLogFile) {
                loadLogContent(currentLogFile);
            }
        }
        
        // å…³é—­æ¨¡æ€æ¡†ï¼ˆç‚¹å‡»å¤–éƒ¨ï¼‰
        window.onclick = function(event) {
            const modal = document.getElementById('edit-modal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>
